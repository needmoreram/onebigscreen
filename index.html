<!DOCTYPE html>
<html>
<head>
<title>One Big Screen &mdash; watch videos with your online friends</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="shortcut icon" href="imgs/favicon.png">
<!-- Bootstrap -->
<link href="bootstrap-3.0.0/dist/css/bootstrap.min.css" rel="stylesheet" media="screen">
<!-- Custom style -->
<link href="//getbootstrap.com/examples/jumbotron-narrow/jumbotron-narrow.css" rel="stylesheet" media="screen">

<!-- HTML5 shim and Respond.js IE8az support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="bootstrap-3.0.0/assets/js/html5shiv.js"></script>
      <script src="bootstrap-3.0.0/assets/js/respond.min.js"></script>
    <![endif]-->
<link href="css/style.css" rel="stylesheet">
</head>
<body>
<div class="container">
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <p class="navbar-text pull-right">
            <span id="greeting"></span>
            <a href="#" id="btnLogin">Login</a>
        </p>
    </nav>
    <div class="header">
        <h3 class="text-muted text-center"><img src="imgs/obsLogo5HD-t.png"/></h3>
    </div>

    <div class="jumbotron">
        <h1>Watch videos with your online friends</h1>
        <p class="lead">Copy and paste a video link below and we will create a custom page where you can watch it in sync with your friends. Play, pause and chat while watching it together!</p>
        <!--<p><a class="btn btn-lg btn-success" href="#">Sign up today</a></p>-->
        <form role="form" class="form-inline">
            <div class="row">
                <div class="col-md-10">
                    <label class="sr-only" for="url">URL</label>
                    <input type="url" class="form-control" id="url" value="http://www.youtube.com/watch?v=F-JFPePh6yM">
                </div>
                <div class="col-md-2">
                    <button id="go" type="submit" class="btn btn-lg btn-success">Go!</button>
                </div>
            </div>
        </form>
    </div>

    <div class="row marketing">
        <div class="col-lg-6">
            <h4>YouTube</h4>
            <p>Watch any video from YouTube by pasting its link in the box above.</p>

            <h4>Amazon S3</h4>
            <p>Upload your videos to Amazon S3 and paste the link directly in the box above.</p>
        </div>

        <div class="col-lg-6">
            <h4>Dropbox</h4>
            <p>Use the link from any video you have stored in Dropbox.</p>

            <h4>Put.io <span class="badge">Coming soon!</span></h4>
            <p>Watch videos from torrents hosted on <a href="http://put.io/">Put.io</a>.</p>
        </div>
    </div>

    <div class="footer">
        <p>&copy; One Big Screen 2013 <span class="pull-right"><a href="mailto:onebigscreen.team@gmail.com">Contact us</a></span></p>
    </div>

</div> <!-- /container -->

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="//code.jquery.com/jquery.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="bootstrap-3.0.0/dist/js/bootstrap.min.js"></script>
<script src='https://cdn.firebase.com/v0/firebase.js'></script>
<script type='text/javascript'
        src='https://cdn.firebase.com/v0/firebase-simple-login.js'>
</script>
<script src="js/plugins/jquery.cookie.js"></script>
<script src="js/loginscript.js"></script>
<script>
    var curruser = null;
    var authRef, auth;
    $(document).ready(function () {
        authRef = new Firebase("https://onebigscreen-fblogin.firebaseio.com");
        auth = new FirebaseSimpleLogin(authRef, processLogin);
        $("form").submit(function (event) {
            event.preventDefault();

            // parse URL
            var url = $("#url").val();
            var parsed = document.createElement("a");
            parsed.href = url;

            if (parsed.hostname == "www.youtube.com") {
                page = "youtube.html";
            } else {
                page = "video.html";
            }

            var fireBaseRef = new Firebase("https://obs.firebaseio.com/videos");
            var videoRef = fireBaseRef.push();
            videoRef.set({ "url": url, currentTime: 0, status: "pause" }, function () {
                var id = videoRef.path.m[1];
                window.location.href = page + "?id=" + id;
            });
        });
        $("#btnLogin").click(function () {
            if ($(this).text() === 'Login') {
                loginUser();
                $(this).text('Logout');
            }
            else {
                logoutUser();
                $(this).text('Login');
            }
            return false;
        });
        getCurrentUser({
            onComplete: function (data) {
                if (data) {
                    console.log(data);
                    curruser = data;
                    displayUser();
                    $("#btnLogin").text('Logout');
                }
            },
            onError: function (error) {
                if (error) {
                    console.log(error);
                }
                $("#btnLogin").text('Login');
            }
        });
    });
    var processLogin = function (error, user) {
        if (error) {
            console.log(error);
        }
        if (user) {
            $.cookie('firebaseAuthToken', user.firebaseAuthToken);
            $.cookie('facebookAuthToken', user.accessToken);
            curruser = { id: user.id,
                fullName: user.name,
                firstName: user.first_name,
                lastName: user.last_name
            };
            displayUser();
        }
    }

    var displayUser = function () {
        $("#greeting").html("Hi, " + curruser.fullName);
    }

    var loginUser = function () {
        auth.login('facebook', {
            rememberMe: true,
            scope: 'email,read_friendlists'
        });
    }
    var logoutUser = function () {
        $.removeCookie('firebaseAuthToken');
        $.removeCookie('facebookAuthToken');
        auth.logout();
        authRef.unauth();
        $("#greeting").html("");
    }

    var getCurrentUser = function (callback) {
        if (!$.cookie('firebaseAuthToken') || !$.cookie('facebookAuthToken')) {
            callback.onComplete();
            return;
        }
        authRef.auth($.cookie('firebaseAuthToken'), function (error, result) {
            if (error) {
                callback.onError(error);
            }
            else {
                if (result != null) {
                    $.ajax({
                        url: 'https://graph.facebook.com/me?access_token=' + $.cookie('facebookAuthToken')
                    }).done(function (data) {
                        callback.onComplete({
                            id: data.id,
                            fullName: data.name,
                            firstName: data.first_name,
                            lastName: data.last_name
                        });
                        //callback.onComplete(data);
                    });
                }
            }
        });
    }
</script>
<script>
    $(document).ready(function() {
        $("form").submit(function(event) {
            event.preventDefault();

            // parse URL
            var url = $("#url").val();
            var parsed = document.createElement("a");
            parsed.href = url;

            if (parsed.hostname == "www.youtube.com") {
                page = "youtube.html";
            } else {
                page = "video.html";
            }

            var videosRef = new Firebase("https://obs.firebaseio.com/videos");
            var videoRef = videosRef.push();
            videoRef.set({"url": url, status: {"action": "pause", "position": 0}}, function() {
                var id = videoRef.path.m[1];
                window.location.href = page + "?id=" + id;
            });
        });
    });
</script>
<script>
// Include the UserVoice JavaScript SDK (only needed once on a page)
UserVoice=window.UserVoice||[];(function(){var uv=document.createElement('script');uv.type='text/javascript';uv.async=true;uv.src='//widget.uservoice.com/XHGJQ6GfJhBSpRlT65I9Lw.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(uv,s)})();

//
// UserVoice Javascript SDK developer documentation:
// https://www.uservoice.com/o/javascript-sdk
//

// Set colors
UserVoice.push(['set', {
  accent_color: '#448dd6',
  trigger_color: 'white',
  trigger_background_color: 'rgba(46, 49, 51, 0.6)'
}]);

// Identify the user and pass traits
// To enable, replace sample data with actual user traits and uncomment the line
UserVoice.push(['identify', {
  //email:      'john.doe@example.com', // User’s email address
  //name:       'John Doe', // User’s real name
  //created_at: 1364406966, // Unix timestamp for the date the user signed up
  //id:         123, // Optional: Unique id of the user (if set, this should not change)
  //type:       'Owner', // Optional: segment your users by type
  //account: {
  //  id:           123, // Optional: associate multiple users with a single account
  //  name:         'Acme, Co.', // Account name
  //  created_at:   1364406966, // Unix timestamp for the date the account was created
  //  monthly_rate: 9.99, // Decimal; monthly rate of the account
  //  ltv:          1495.00, // Decimal; lifetime value of the account
  //  plan:         'Enhanced' // Plan name for the account
  //}
}]);

// Add default trigger to the bottom-right corner of the window:
UserVoice.push(['addTrigger', { mode: 'contact', trigger_position: 'top-right' }]);

// Or, use your own custom trigger:
//UserVoice.push(['addTrigger', '#id', { mode: 'contact' }]);

// Autoprompt for Satisfaction and SmartVote (only displayed under certain conditions)
UserVoice.push(['autoprompt', {}]);
</script>
</body>
</html>
